<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¦éš›æ‡‰ç”¨å•é¡Œæª¢æŸ¥</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .section {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .btn {
            margin: 5px;
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            background: white;
        }
        .btn:hover {
            background: #f0f0f0;
        }
        .output {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
    </style>
</head>
<body data-theme="cuteCats">
    <div class="container">
        <h1>å¯¦éš›æ‡‰ç”¨å•é¡Œæª¢æŸ¥</h1>
        
        <div class="section">
            <h3>æ­¥é©Ÿ 1: æª¢æŸ¥å¯¦éš›æ‡‰ç”¨çš„JavaScript</h3>
            <button class="btn" onclick="loadRealAppJS()">è¼‰å…¥å¯¦éš›æ‡‰ç”¨JS</button>
            <button class="btn" onclick="testRealBudgetModal()">æ¸¬è©¦çœŸå¯¦é ç®—è¨­å®š</button>
            <div id="jsOutput" class="output">é»æ“ŠæŒ‰éˆ•é–‹å§‹æª¢æŸ¥...</div>
        </div>
        
        <div class="section">
            <h3>æ­¥é©Ÿ 2: æª¢æŸ¥CSSè¡çª</h3>
            <button class="btn" onclick="checkCSSConflicts()">æª¢æŸ¥CSSè¡çª</button>
            <button class="btn" onclick="testCSSPriority()">æ¸¬è©¦CSSå„ªå…ˆç´š</button>
            <div id="cssOutput" class="output">é»æ“ŠæŒ‰éˆ•é–‹å§‹æª¢æŸ¥...</div>
        </div>
        
        <div class="section">
            <h3>æ­¥é©Ÿ 3: æ¨¡æ“¬å®Œæ•´é ç®—è¨­å®šæµç¨‹</h3>
            <button class="btn" onclick="simulateFullBudgetFlow()">æ¨¡æ“¬å®Œæ•´æµç¨‹</button>
            <button class="btn" onclick="testWithRealData()">ä½¿ç”¨çœŸå¯¦æ•¸æ“šæ¸¬è©¦</button>
            <div id="flowOutput" class="output">é»æ“ŠæŒ‰éˆ•é–‹å§‹æª¢æŸ¥...</div>
        </div>
        
        <div class="section">
            <h3>æ¸¬è©¦å€åŸŸ</h3>
            <div id="testArea"></div>
        </div>
    </div>
    
    <script>
        // è¼‰å…¥å¯¦éš›æ‡‰ç”¨çš„JavaScriptå‡½æ•¸
        function loadRealAppJS() {
            const output = document.getElementById('jsOutput');
            output.innerHTML = 'æ­£åœ¨è¼‰å…¥å¯¦éš›æ‡‰ç”¨JavaScript...\n';
            
            // å˜—è©¦è¼‰å…¥script.jsä¸­çš„ç›¸é—œå‡½æ•¸
            fetch('script.js')
                .then(response => response.text())
                .then(scriptContent => {
                    output.innerHTML += 'âœ… script.js è¼‰å…¥æˆåŠŸ\n';
                    
                    // æª¢æŸ¥æ˜¯å¦æœ‰showBudgetSettingDialogå‡½æ•¸
                    if (scriptContent.includes('showBudgetSettingDialog')) {
                        output.innerHTML += 'âœ… æ‰¾åˆ° showBudgetSettingDialog å‡½æ•¸\n';
                        
                        // æå–å‡½æ•¸ä»£ç¢¼
                        const functionStart = scriptContent.indexOf('function showBudgetSettingDialog');
                        if (functionStart !== -1) {
                            const functionEnd = scriptContent.indexOf('function ', functionStart + 1);
                            const functionCode = functionEnd !== -1 ? 
                                scriptContent.substring(functionStart, functionEnd) :
                                scriptContent.substring(functionStart);
                            
                            output.innerHTML += 'âœ… æå–å‡½æ•¸ä»£ç¢¼æˆåŠŸ\n';
                            output.innerHTML += 'å‡½æ•¸é•·åº¦: ' + functionCode.length + ' å­—ç¬¦\n';
                            
                            // æª¢æŸ¥å‡½æ•¸ä¸­æ˜¯å¦æœ‰å…§è¯æ¨£å¼
                            if (functionCode.includes('style="background:')) {
                                output.innerHTML += 'âŒ ç™¼ç¾å…§è¯èƒŒæ™¯æ¨£å¼\n';
                            } else {
                                output.innerHTML += 'âœ… æ²’æœ‰ç™¼ç¾å…§è¯èƒŒæ™¯æ¨£å¼\n';
                            }
                            
                            // å˜—è©¦åŸ·è¡Œå‡½æ•¸ï¼ˆå¯èƒ½æœƒå¤±æ•—ï¼‰
                            try {
                                eval(functionCode);
                                output.innerHTML += 'âœ… å‡½æ•¸å®šç¾©æˆåŠŸ\n';
                                window.hasRealBudgetFunction = true;
                            } catch (e) {
                                output.innerHTML += 'âŒ å‡½æ•¸å®šç¾©å¤±æ•—: ' + e.message + '\n';
                            }
                        }
                    } else {
                        output.innerHTML += 'âŒ æ²’æœ‰æ‰¾åˆ° showBudgetSettingDialog å‡½æ•¸\n';
                    }
                })
                .catch(error => {
                    output.innerHTML += 'âŒ script.js è¼‰å…¥å¤±æ•—: ' + error.message + '\n';
                });
        }
        
        function testRealBudgetModal() {
            const output = document.getElementById('jsOutput');
            
            if (!window.hasRealBudgetFunction) {
                output.innerHTML += 'âŒ è«‹å…ˆè¼‰å…¥å¯¦éš›æ‡‰ç”¨JavaScript\n';
                return;
            }
            
            output.innerHTML += 'æ­£åœ¨æ¸¬è©¦çœŸå¯¦é ç®—è¨­å®šæ¨¡æ…‹æ¡†...\n';
            
            try {
                // æ¨¡æ“¬çœŸå¯¦çš„é ç®—è¨­å®šèª¿ç”¨
                showBudgetSettingDialog('é¤é£²');
                
                setTimeout(() => {
                    const modal = document.querySelector('.budget-setting-modal-content');
                    if (modal) {
                        const computedStyle = window.getComputedStyle(modal);
                        const hasBackgroundImage = computedStyle.backgroundImage.includes('956499812b93c3c5bf8226051c7e627f');
                        
                        output.innerHTML += `=== çœŸå¯¦æ¨¡æ…‹æ¡†æ¸¬è©¦çµæœ ===\n`;
                        output.innerHTML += `èƒŒæ™¯åœ–ç‰‡: ${hasBackgroundImage ? 'âœ… æ­£ç¢º' : 'âŒ éŒ¯èª¤'}\n`;
                        output.innerHTML += `å¯¦éš›èƒŒæ™¯: ${computedStyle.backgroundColor}\n`;
                        output.innerHTML += `èƒŒæ™¯åœ–ç‰‡URL: ${computedStyle.backgroundImage}\n`;
                        
                        if (!hasBackgroundImage) {
                            output.innerHTML += `\nâŒ å•é¡Œåˆ†æ:\n`;
                            output.innerHTML += `- çœŸå¯¦æ‡‰ç”¨ä¸­çš„æ¨¡æ…‹æ¡†æ²’æœ‰é¡¯ç¤ºèƒŒæ™¯åœ–ç‰‡\n`;
                            output.innerHTML += `- å¯èƒ½æ˜¯JavaScriptå‹•æ…‹è¨­ç½®äº†èƒŒæ™¯\n`;
                            output.innerHTML += `- å¯èƒ½æ˜¯CSSå„ªå…ˆç´šå•é¡Œ\n`;
                        }
                        
                        // 5ç§’å¾Œé—œé–‰æ¨¡æ…‹æ¡†
                        setTimeout(() => {
                            const modalOverlay = document.querySelector('.budget-setting-modal');
                            if (modalOverlay) {
                                document.body.removeChild(modalOverlay);
                            }
                        }, 5000);
                    } else {
                        output.innerHTML += 'âŒ æ²’æœ‰æ‰¾åˆ°é ç®—è¨­å®šæ¨¡æ…‹æ¡†\n';
                    }
                }, 500);
            } catch (e) {
                output.innerHTML += 'âŒ æ¸¬è©¦å¤±æ•—: ' + e.message + '\n';
            }
        }
        
        function checkCSSConflicts() {
            const output = document.getElementById('cssOutput');
            output.innerHTML = 'æ­£åœ¨æª¢æŸ¥CSSè¡çª...\n';
            
            // å‰µå»ºæ¸¬è©¦å…ƒç´ 
            const testElement = document.createElement('div');
            testElement.className = 'budget-setting-modal-content';
            testElement.style.cssText = 'width: 200px; height: 100px; padding: 10px; margin: 10px; border: 1px solid #ccc;';
            document.getElementById('testArea').appendChild(testElement);
            
            setTimeout(() => {
                const computedStyle = window.getComputedStyle(testElement);
                
                output.innerHTML += `=== CSSè¡çªæª¢æŸ¥ ===\n`;
                output.innerHTML += `ç•¶å‰ä¸»é¡Œ: ${document.body.getAttribute('data-theme')}\n`;
                output.innerHTML += `èƒŒæ™¯åœ–ç‰‡: ${computedStyle.backgroundImage.includes('956499812b93c3c5bf8226051c7e627f') ? 'âœ… æ­£ç¢º' : 'âŒ éŒ¯èª¤'}\n`;
                output.innerHTML += `èƒŒæ™¯é¡è‰²: ${computedStyle.backgroundColor}\n`;
                output.innerHTML += `æ··åˆæ¨¡å¼: ${computedStyle.backgroundBlendMode}\n`;
                output.innerHTML += `æ¯›ç»ç’ƒ: ${computedStyle.backdropFilter}\n\n`;
                
                // æª¢æŸ¥æ˜¯å¦æœ‰å…¶ä»–æ¨£å¼è¦†è“‹
                output.innerHTML += `=== æ¨£å¼å„ªå…ˆç´šåˆ†æ ===\n`;
                
                // æª¢æŸ¥é€šç”¨æ¨£å¼
                const genericModal = document.createElement('div');
                genericModal.className = 'modal-content';
                genericModal.style.cssText = 'width: 200px; height: 100px; padding: 10px; margin: 10px; border: 1px solid #ccc;';
                document.getElementById('testArea').appendChild(genericModal);
                
                setTimeout(() => {
                    const genericStyle = window.getComputedStyle(genericModal);
                    output.innerHTML += `é€šç”¨æ¨¡æ…‹æ¡†èƒŒæ™¯: ${genericStyle.backgroundColor}\n`;
                    
                    if (genericStyle.backgroundColor !== 'rgba(0, 0, 0, 0)' && genericStyle.backgroundColor !== 'transparent') {
                        output.innerHTML += `âš ï¸ é€šç”¨æ¨¡æ…‹æ¡†æœ‰èƒŒæ™¯è‰²ï¼Œå¯èƒ½å½±éŸ¿å„ªå…ˆç´š\n`;
                    }
                    
                    // æ¸…ç†æ¸¬è©¦å…ƒç´ 
                    document.getElementById('testArea').innerHTML = '';
                    
                }, 100);
            }, 100);
        }
        
        function testCSSPriority() {
            const output = document.getElementById('cssOutput');
            output.innerHTML = 'æ­£åœ¨æ¸¬è©¦CSSå„ªå…ˆç´š...\n';
            
            // å‰µå»ºå¤šå€‹ä¸åŒé¸æ“‡å™¨çš„æ¸¬è©¦å…ƒç´ 
            const tests = [
                { selector: '.budget-setting-modal-content', name: 'åŸºç¤é¸æ“‡å™¨' },
                { selector: 'body .budget-setting-modal-content', name: 'bodyé¸æ“‡å™¨' },
                { selector: '[data-theme="cuteCats"] .budget-setting-modal-content', name: 'å±¬æ€§é¸æ“‡å™¨' },
                { selector: 'body[data-theme="cuteCats"] .budget-setting-modal-content', name: 'body+å±¬æ€§é¸æ“‡å™¨' },
                { selector: ':root[data-theme="cuteCats"] .budget-setting-modal-content', name: 'rooté¸æ“‡å™¨' },
                { selector: 'html:has([data-theme="cuteCats"]) .budget-setting-modal-content', name: 'html:hasé¸æ“‡å™¨' }
            ];
            
            output.innerHTML += `=== CSSå„ªå…ˆç´šæ¸¬è©¦ ===\n\n`;
            
            tests.forEach((test, index) => {
                const element = document.createElement('div');
                element.className = 'budget-setting-modal-content';
                element.style.cssText = 'width: 150px; height: 50px; padding: 5px; margin: 5px; border: 1px solid #ccc; font-size: 12px;';
                element.textContent = test.name;
                document.getElementById('testArea').appendChild(element);
                
                setTimeout(() => {
                    const computedStyle = window.getComputedStyle(element);
                    const hasBackgroundImage = computedStyle.backgroundImage.includes('956499812b93c3c5bf8226051c7e627f');
                    
                    output.innerHTML += `${test.name}: ${hasBackgroundImage ? 'âœ…' : 'âŒ'}\n`;
                    
                    if (index === tests.length - 1) {
                        setTimeout(() => {
                            document.getElementById('testArea').innerHTML = '';
                        }, 1000);
                    }
                }, 100 * (index + 1));
            });
        }
        
        function simulateFullBudgetFlow() {
            const output = document.getElementById('flowOutput');
            output.innerHTML = 'æ­£åœ¨æ¨¡æ“¬å®Œæ•´é ç®—è¨­å®šæµç¨‹...\n';
            
            // æ­¥é©Ÿ1: æª¢æŸ¥localStorage
            const budgets = JSON.parse(localStorage.getItem('categoryBudgets') || '{}');
            output.innerHTML += `âœ… é ç®—æ•¸æ“š: ${Object.keys(budgets).length} å€‹åˆ†é¡\n`;
            
            // æ­¥é©Ÿ2: æª¢æŸ¥åˆ†é¡æ•¸æ“š
            if (typeof allCategories !== 'undefined') {
                const category = allCategories.find(cat => cat.name === 'é¤é£²');
                output.innerHTML += `âœ… åˆ†é¡æ•¸æ“š: ${category ? 'æ‰¾åˆ°é¤é£²åˆ†é¡' : 'æ²’æœ‰æ‰¾åˆ°é¤é£²åˆ†é¡'}\n`;
            } else {
                output.innerHTML += `âš ï¸  åˆ†é¡æ•¸æ“š: allCategories æœªå®šç¾©\n`;
            }
            
            // æ­¥é©Ÿ3: å‰µå»ºæ¨¡æ…‹æ¡†
            const budgetModal = document.createElement('div');
            budgetModal.className = 'budget-setting-modal';
            
            // ä½¿ç”¨èˆ‡å¯¦éš›æ‡‰ç”¨å®Œå…¨ç›¸åŒçš„HTMLçµæ§‹
            budgetModal.innerHTML = `
                <div class="budget-setting-modal-content" style="border-radius: 24px; padding: 28px; max-width: 420px; width: 100%; box-shadow: var(--shadow-primary-lg), 0 4px 16px rgba(0, 0, 0, 0.15); border: 1px solid var(--color-primary-rgba-20); animation: slideIn 0.3s ease-out;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h2 style="margin: 0; font-size: 22px; font-weight: 600; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 28px;">ğŸ½ï¸</span>
                            <span>è¨­å®šé ç®—</span>
                        </h2>
                        <button onclick="this.closest('.budget-setting-modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-tertiary);">Ã—</button>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-primary);">é ç®—é‡‘é¡</label>
                        <input type="number" value="5000" style="width: 100%; padding: 12px; border: 2px solid var(--border-light); border-radius: 12px; background: rgba(255, 255, 255, 0.8);">
                    </div>
                </div>
            `;
            
            document.body.appendChild(budgetModal);
            
            setTimeout(() => {
                const modalContent = budgetModal.querySelector('.budget-setting-modal-content');
                if (modalContent) {
                    const computedStyle = window.getComputedStyle(modalContent);
                    const hasBackgroundImage = computedStyle.backgroundImage.includes('956499812b93c3c5bf8226051c7e627f');
                    
                    output.innerHTML += `\n=== å®Œæ•´æµç¨‹æ¸¬è©¦çµæœ ===\n`;
                    output.innerHTML += `æ¨¡æ…‹æ¡†å‰µå»º: âœ…\n`;
                    output.innerHTML += `èƒŒæ™¯åœ–ç‰‡: ${hasBackgroundImage ? 'âœ… æ­£ç¢º' : 'âŒ éŒ¯èª¤'}\n`;
                    output.innerHTML += `å¯¦éš›èƒŒæ™¯: ${computedStyle.backgroundColor}\n`;
                    output.innerHTML += `å…§è¯æ¨£å¼: ${modalContent.hasAttribute('style') ? 'æœ‰' : 'ç„¡'}\n`;
                    
                    if (modalContent.hasAttribute('style')) {
                        output.innerHTML += `å…§è¯å…§å®¹: ${modalContent.getAttribute('style')}\n`;
                    }
                    
                    if (!hasBackgroundImage) {
                        output.innerHTML += `\nâŒ å•é¡Œè¨ºæ–·:\n`;
                        output.innerHTML += `1. æª¢æŸ¥å…§è¯æ¨£å¼æ˜¯å¦è¦†è“‹äº†CSS\n`;
                        output.innerHTML += `2. æª¢æŸ¥CSSæ–‡ä»¶æ˜¯å¦æ­£ç¢ºè¼‰å…¥\n`;
                        output.innerHTML += `3. æª¢æŸ¥é¸æ“‡å™¨å„ªå…ˆç´š\n`;
                    }
                    
                    // 5ç§’å¾Œè‡ªå‹•é—œé–‰
                    setTimeout(() => {
                        if (document.body.contains(budgetModal)) {
                            document.body.removeChild(budgetModal);
                        }
                    }, 5000);
                }
            }, 500);
        }
        
        function testWithRealData() {
            const output = document.getElementById('flowOutput');
            output.innerHTML = 'æ­£åœ¨ä½¿ç”¨çœŸå¯¦æ•¸æ“šæ¸¬è©¦...\n';
            
            // æª¢æŸ¥å¯¦éš›çš„åˆ†é¡æ•¸æ“š
            fetch('js/categories.js')
                .then(response => response.text())
                .then(categoriesContent => {
                    output.innerHTML += 'âœ… categories.js è¼‰å…¥æˆåŠŸ\n';
                    
                    // å˜—è©¦è§£æåˆ†é¡
                    try {
                        eval(categoriesContent);
                        output.innerHTML += `âœ… åˆ†é¡æ•¸æ“šè§£ææˆåŠŸ: ${allCategories ? allCategories.length : 0} å€‹åˆ†é¡\n`;
                        
                        // æ‰¾åˆ°ç¬¬ä¸€å€‹åˆ†é¡é€²è¡Œæ¸¬è©¦
                        const testCategory = allCategories ? allCategories[0] : { name: 'æ¸¬è©¦', icon: 'ğŸ½ï¸' };
                        
                        // ä½¿ç”¨çœŸå¯¦åˆ†é¡æ•¸æ“šå‰µå»ºæ¨¡æ…‹æ¡†
                        const budgetModal = document.createElement('div');
                        budgetModal.className = 'budget-setting-modal';
                        
                        budgetModal.innerHTML = `
                            <div class="budget-setting-modal-content">
                                <h2 style="margin: 0 0 20px 0; font-size: 22px; font-weight: 600; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 28px;">${testCategory.icon || 'ğŸ’°'}</span>
                                    ${testCategory.name} - é ç®—è¨­å®š
                                </h2>
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-primary);">æœˆåº¦é ç®—é‡‘é¡</label>
                                    <input type="number" placeholder="è¼¸å…¥é ç®—é‡‘é¡" style="width: 100%; padding: 12px; border: 2px solid var(--border-light); border-radius: 8px; background: rgba(255, 255, 255, 0.8);">
                                </div>
                                <button onclick="this.closest('.budget-setting-modal').remove()" style="padding: 10px 20px; border: none; border-radius: 8px; background: var(--color-primary); color: white; cursor: pointer;">é—œé–‰</button>
                            </div>
                        `;
                        
                        document.body.appendChild(budgetModal);
                        
                        setTimeout(() => {
                            const modalContent = budgetModal.querySelector('.budget-setting-modal-content');
                            if (modalContent) {
                                const computedStyle = window.getComputedStyle(modalContent);
                                const hasBackgroundImage = computedStyle.backgroundImage.includes('956499812b93c3c5bf8226051c7e627f');
                                
                                output.innerHTML += `\n=== çœŸå¯¦æ•¸æ“šæ¸¬è©¦çµæœ ===\n`;
                                output.innerHTML += `ä½¿ç”¨åˆ†é¡: ${testCategory.name}\n`;
                                output.innerHTML += `èƒŒæ™¯åœ–ç‰‡: ${hasBackgroundImage ? 'âœ… æ­£ç¢º' : 'âŒ éŒ¯èª¤'}\n`;
                                output.innerHTML += `èƒŒæ™¯é¡è‰²: ${computedStyle.backgroundColor}\n`;
                                
                                setTimeout(() => {
                                    if (document.body.contains(budgetModal)) {
                                        document.body.removeChild(budgetModal);
                                    }
                                }, 3000);
                            }
                        }, 500);
                        
                    } catch (e) {
                        output.innerHTML += 'âŒ åˆ†é¡æ•¸æ“šè§£æå¤±æ•—: ' + e.message + '\n';
                    }
                })
                .catch(error => {
                    output.innerHTML += 'âŒ categories.js è¼‰å…¥å¤±æ•—: ' + error.message + '\n';
                });
        }
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥åŸºç¤CSS
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkCSSConflicts();
            }, 500);
        });
    </script>
</body>
</html>
